define(["lodash","moment","app/core/config","app/plugins/sdk","angular"],function(e,t,r,n,o){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=4)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KustoDBDatasource=void 0;var n=u(r(0)),o=r(5),a=u(r(6)),i=u(r(7)),s=u(r(8));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(e,t,r,n){this.backendSrv=t,this.$q=r,this.templateSrv=n,this.name=e.name,this.id=e.id,this.baseUrl="/azuredataexplorer",this.url=e.url,this.defaultOrFirstDatabase=e.jsonData.defaultDatabase,this.cache=new i.default({ttl:this.getCacheTtl(e)}),this.requestAggregatorSrv=new s.default(t)}return e.$inject=["instanceSettings","backendSrv","$q","templateSrv"],e.prototype.query=function(e){var t=this,r=n.default.filter(e.targets,function(e){return!0!==e.hide&&e.query&&-1===e.query.indexOf("<table name>")}).map(function(r){var n=t.baseUrl+"/v1/rest/query",o=new a.default(t.templateSrv.replace(r.query,e.scopedVars,t.interpolateVariable),e).interpolate().query;return{key:n+"-"+e.intervalMs+"-"+e.maxDataPoints+"-"+e.format+"-"+r.resultFormat+"-"+o,refId:r.refId,intervalMs:e.intervalMs,maxDataPoints:e.maxDataPoints,datasourceId:t.id,url:n,query:o,format:e.format,resultFormat:r.resultFormat,data:{csl:o,db:r.database}}});if(!r||0===r.length)return{data:[]};var i=this.doQueries(r);return this.$q.all(i).then(function(e){return(new o.ResponseParser).parseQueryResult(e)})},e.prototype.annotationQuery=function(e){if(!e.annotation.rawQuery)return this.$q.reject({message:"Query missing in annotation definition"});var t=this.buildQuery(e.annotation.rawQuery,e,e.annotation.database),r=this.doQueries(t);return this.$q.all(r).then(function(t){return(new o.ResponseParser).transformToAnnotations(e,t)})},e.prototype.metricFindQuery=function(e){var t=this;return this.getDefaultOrFirstDatabase().then(function(r){var n=t.buildQuery(e,null,r),a=t.doQueries(n);return t.$q.all(a).then(function(e){return(new o.ResponseParser).parseToVariables(e)}).catch(function(e){if(e.error&&e.error.data&&e.error.data.error)throw{message:e.error.data.error["@message"]}})})},e.prototype.testDatasource=function(){var e=this;return this.testDatasourceConnection().then(function(){return e.testDatasourceAccess()}).catch(function(e){return{status:"error",message:e.message+" Connection to database could not be established."}})},e.prototype.testDatasourceConnection=function(){var e=this.baseUrl+"/v1/rest/mgmt";return this.doRequest(e,{csl:".show databases"}).then(function(e){return 200===e.status?{status:"success",message:"Successfully queried the Azure Data Explorer database.",title:"Success"}:{status:"error",message:"Returned http status code "+e.status}}).catch(function(e){var t="Azure Data Explorer: ";return t+=e.statusText?e.statusText+": ":"",e.data&&e.data.Message?t+=e.data.Message:e.data?t+=e.data:t+="Cannot connect to the Azure Data Explorer REST API.",{status:"error",message:t}})},e.prototype.testDatasourceAccess=function(){var e=this.baseUrl+"/v1/rest/mgmt";return this.doRequest(e,{csl:".show databases schema"}).then(function(e){return 200===e.status?{status:"success",message:"Successfully queried the Azure Data Explorer database.",title:"Success"}:{status:"error",message:"Returned http status code "+e.status}}).catch(function(e){var t="Azure Data Explorer: Cannot read database schema from REST API. ";return t+=e.statusText?e.statusText+": ":"",e.data&&e.data.error&&e.data.error["@message"]?t+=e.data.error&&e.data.error["@message"]:e.data?t+=JSON.stringify(e.data):t+="Cannot read database schema from Azure Data Explorer REST API.",{status:"error",message:t}})},e.prototype.getDatabases=function(){var e=this.baseUrl+"/v1/rest/mgmt";return this.doRequest(e,{csl:".show databases"}).then(function(e){return(new o.ResponseParser).parseDatabases(e)})},e.prototype.getDefaultOrFirstDatabase=function(){var e=this;return this.defaultOrFirstDatabase?Promise.resolve(this.defaultOrFirstDatabase):this.getDatabases().then(function(t){return e.defaultOrFirstDatabase=t[0].value,e.defaultOrFirstDatabase})},e.prototype.getSchema=function(e){var t=this.baseUrl+"/v1/rest/mgmt",r={csl:".show database ["+e+"] schema as json"};return this.doRequest(t,r).then(function(e){return(new o.ResponseParser).parseSchemaResult(e.data)})},e.prototype.doQueries=function(e){var t=this;return e.map(function(e){return t.cache.get(e.key)||t.requestAggregatorSrv.dsPost(e.key,t.url+e.url,e.data).then(function(r){var n={result:r,query:e};return e.key&&t.cache.put(e.key,n),n}).catch(function(t){throw{error:t,query:e}})})},e.prototype.buildQuery=function(e,t,r){var n=new a.default(this.templateSrv.replace(e,{},this.interpolateVariable),t),o=this.baseUrl+"/v1/rest/query",i=n.interpolate().query,s=[];return s.push({key:o+"-table-"+r+"-"+i,datasourceId:this.id,url:o,resultFormat:"table",data:{csl:i,db:r}}),s},e.prototype.doRequest=function(e,t,r){var n=this;return void 0===r&&(r=1),this.backendSrv.datasourceRequest({url:this.url+e,method:"POST",data:t}).catch(function(o){if(r>0)return n.doRequest(e,t,r-1);throw o})},e.prototype.interpolateVariable=function(e,t){return"string"==typeof e?t.multi||t.includeAll?"'"+e+"'":e:"number"==typeof e?e:n.default.map(e,function(t){return"number"==typeof e?e:"'"+t+"'"}).join(",")},e.prototype.getCacheTtl=function(e){if(void 0===e.jsonData.minimalCache)return 3e4;if(e.jsonData.minimalCache<1)throw new Error("Minimal cache must be greater than or equal to 1.");return 1e3*e.jsonData.minimalCache},e}();t.KustoDBDatasource=l},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationsQueryCtrl=t.ConfigCtrl=t.QueryCtrl=t.Datasource=void 0;var n=r(1),o=r(9),a=r(14),i=r(15);t.Datasource=n.KustoDBDatasource,t.QueryCtrl=o.KustoDBQueryCtrl,t.ConfigCtrl=i.KustoDBConfigCtrl,t.AnnotationsQueryCtrl=a.KustoDBAnnotationsQueryCtrl},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResponseParser=void 0;var n=a(r(0)),o=a(r(2));function a(e){return e&&e.__esModule?e:{default:e}}var i=function(){function e(){}return e.prototype.parseDatabases=function(e){var t=[];if(!e||!e.data||!e.data.Tables||0===e.data.Tables.length)return t;for(var r=0,n=e.data.Tables;r<n.length;r++)for(var o=0,a=n[r].Rows;o<a.length;o++){var i=a[o];t.push({text:i[5]||i[0],value:i[0]})}return t},e.prototype.parseSchemaResult=function(e){var t=e.Tables[0].Rows[0][0];return JSON.parse(t)},e.prototype.parseQueryResult=function(e){for(var t=[],r=[],o=0;o<e.length;o++)if(0!==e[o].result.data.Tables.length){r=e[o].result.data.Tables[0].Columns;var a=e[o].result.data.Tables[0].Rows;t="time_series"===e[o].query.resultFormat?n.default.concat(t,this.parseTimeSeriesResult(e[o].query,r,a)):n.default.concat(t,this.parseTableResult(e[o].query,r,a))}return{data:t}},e.prototype.parseTimeSeriesResult=function(t,r,n){for(var o=[],a=-1,i=-1,s=-1,u=0;u<r.length;u++)-1===a&&"datetime"===r[u].ColumnType&&(a=u),-1===i&&"string"===r[u].ColumnType&&(i=u),-1===s&&["int","long","real","double"].includes(r[u].ColumnType)&&(s=u);if(-1===a)throw new Error("No datetime column found in the result. The Time Series format requires a time column.");for(var l=0,c=n;l<c.length;l++){var d=c[l],f=e.dateTimeToEpoch(d[a]),h=i>-1?d[i]:r[s].name,p=e.findOrCreateBucket(o,h);p.datapoints.push([d[s],f]),p.refId=t.refId,p.query=t.query}return o},e.prototype.parseTableResult=function(e,t,r){return{type:"table",columns:n.default.map(t,function(e){return{text:e.ColumnName,type:e.ColumnType}}),rows:r,refId:e.refId,query:e.query}},e.prototype.parseToVariables=function(e){for(var t=[],r=0,o=this.parseQueryResult(e).data;r<o.length;r++)for(var a=o[r],i=0,s=n.default.flattenDeep(a.rows);i<s.length;i++){var u=s[i];t.push({text:u,value:u})}return t},e.prototype.transformToAnnotations=function(t,r){for(var n=[],o=0,a=this.parseQueryResult(r).data;o<a.length;o++){for(var i=a[o],s=-1,u=-1,l=-1,c=0;c<i.columns.length;c++)-1===s&&"datetime"===i.columns[c].type&&(s=c),-1===u&&"text"===i.columns[c].text.toLowerCase()&&(u=c),-1===l&&"tags"===i.columns[c].text.toLowerCase()&&(l=c);for(var d=0,f=i.rows;d<f.length;d++){var h=f[d];n.push({annotation:t.annotation,time:Math.floor(e.dateTimeToEpoch(h[s])),text:h[u]?h[u].toString():"",tags:h[l]?h[l].trim().split(/\s*,\s*/):[]})}}return n},e.findOrCreateBucket=function(e,t){var r=n.default.find(e,["target",t]);return r||(r={target:t,datapoints:[],refId:"",query:""},e.push(r)),r},e.dateTimeToEpoch=function(e){return(0,o.default)(e).valueOf()},e}();t.ResponseParser=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(2)),o=function(){function e(e,t){this.rawQuery=e,this.options=t}return e.prototype.interpolate=function(){var e=this;if(!this.rawQuery)return{query:""};var t=this.rawQuery,r=/\$__([_a-zA-Z0-9]+)\(([^\)]*)\)/gi;if(t=(t=t.replace(r,function(t,r,n){return"contains"===r?e.getMultiContains(n):t})).replace(/\$__escapeMulti\(('[^]*')\)/gi,function(t,r){return e.escape(r)}),this.options){var n="";if(t=(t=(t=(t=t.replace(r,function(t,r,o){return"timeFilter"===r?(n=o.trim(),e.getTimeFilter(o,e.options)):t})).replace(/\$__interval/gi,this.options.interval)).replace(/\$__from/gi,this.getFrom(this.options))).replace(/\$__to/gi,this.getUntil(this.options)),!/order\s+by/gi.test(t)){if(!n){var o=/bin\(([_a-zA-Z0-9]+),/.exec(t);n=o?o[1]:""}n&&(t+="\n| order by "+n+" asc")}}return{query:t}},e.prototype.getFrom=function(e){var t=e.range.from;return"datetime("+(0,n.default)(t).startOf("minute").toISOString()+")"},e.prototype.getUntil=function(e){if("now"===e.rangeRaw.to)return"now()";var t=e.range.to;return"datetime("+(0,n.default)(t).startOf("minute").toISOString()+")"},e.prototype.getTimeFilter=function(e,t){return"now"===t.rangeRaw.to?e+" >= "+this.getFrom(t):e+"  >= "+this.getFrom(t)+" and "+e+" <= "+this.getUntil(t)},e.prototype.getMultiContains=function(e){var t=e.indexOf(","),r=e.substring(0,t),n=e.substring(e.indexOf(",")+1);return n&&"all"===n.toLowerCase().trim()?"1 == 1":r.trim()+" in ("+n.trim()+")"},e.prototype.escape=function(e){return e.substring(1,e.length-1).split("','").map(function(e){return"@'"+e+"'"}).join(", ")},e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){void 0===e&&(e={ttl:1e4}),this.opts=e,this.store={}}return e.prototype.put=function(e,t,r){var n=this;void 0===r&&(r=this.opts.ttl),void 0!==e&&void 0!==t&&(this.del(e),this.store[e]={value:t,expire:Date.now()+r,timeout:setTimeout(function(){n.del(e)},r)})},e.prototype.get=function(e){var t=this.store[e];return t&&t.expire&&t.expire<=Date.now()&&(this.del(e),t=void 0),t&&t.value},e.prototype.del=function(e){this.store.hasOwnProperty(e)&&(clearTimeout(this.store[e].timeout),delete this.store[e])},e}();t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{u(n.next(e))}catch(e){a(e)}}function s(e){try{u(n.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(i,s)}u((n=n.apply(e,t||[])).next())})},o=function(e,t){var r,n,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,n=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},a=function(){function e(e){this.backendSrv=e,this.ongoingRequests={}}return e.prototype.doRequest=function(e,t,r){return void 0===r&&(r=1),n(this,void 0,void 0,function(){var n=this;return o(this,function(o){return[2,this.backendSrv.datasourceRequest({url:e,method:"POST",data:t}).catch(function(o){if(r>0)return n.doRequest(e,t,r-1);throw o})]})})},e.prototype.dsPost=function(e,t,r){return n(this,void 0,void 0,function(){var a=this;return o(this,function(i){return this.ongoingRequests.hasOwnProperty(e)?[2,this.ongoingRequests[e]]:(this.ongoingRequests[e]=new Promise(function(i,s){return n(a,void 0,void 0,function(){var n,a;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,3,4]),[4,this.doRequest(t,r)];case 1:return n=o.sent(),i(n),[3,4];case 2:return a=o.sent(),s(a),[3,4];case 3:return delete this.ongoingRequests[e],[7];case 4:return[2]}})})}),[2,this.ongoingRequests[e]])})})},e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KustoDBQueryCtrl=void 0;var n=r(10),o=function(e){return e&&e.__esModule?e:{default:e}}(r(0));r(11);var a=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.defaults={query:["//change this to create your own time series query","","<table name>","| where $__timeFilter(Timestamp)","// | summarize count() by <group by column>, bin(Timestamp, $__interval)","// | order by Timestamp asc"].join("\n"),resultFormat:"time_series",database:""},o.default.defaultsDeep(n.target,n.defaults),n.panelCtrl.events.on("data-received",n.onDataReceived.bind(n),t),n.panelCtrl.events.on("data-error",n.onDataError.bind(n),t),n.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],n.getDatabases(),n}return a(t,e),t.$inject=["$scope","$injector"],t.prototype.onDataReceived=function(e){this.lastQueryError=void 0,this.lastQuery="";var t=o.default.find(e,{refId:this.target.refId});t&&(this.lastQuery=t.query)},t.prototype.onDataError=function(e){this.handleQueryCtrlError(e)},t.prototype.handleQueryCtrlError=function(e){e.query&&e.query.refId&&e.query.refId!==this.target.refId||(e.error&&e.error.data&&e.error.data.error&&e.error.data.error.innererror?e.error.data.error.innererror.innererror?this.lastQueryError=e.error.data.error.innererror.innererror.message:this.lastQueryError=e.error.data.error.innererror["@message"]:e.error&&e.error.data&&e.error.data.error?this.lastQueryError=e.error.data.error.message:e.error&&e.error.data?this.lastQueryError=e.error.data.message:e.data&&e.data.error?this.lastQueryError=e.data.error.message:e.data&&e.data.message?this.lastQueryError=e.data.message:this.lastQueryError=e)},t.prototype.getDatabases=function(){var e=this;return this.datasource.getDatabases().then(function(t){e.databases=t,t.length>0&&!e.target.database&&(e.target.database=e.datasource.defaultOrFirstDatabase||t[0].value)})},t.prototype.getSchema=function(){var e=this;return this.getDatabases().then(function(){return e.datasource.getSchema(e.target.database)})},t.templateUrl="partials/query.editor.html",t}(n.QueryCtrl);t.KustoDBQueryCtrl=i},function(e,t){e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.kustoMonacoEditorDirective=l;var n=i(r(12)),o=i(r(13)),a=i(r(3));function i(e){return e&&e.__esModule?e:{default:e}}var s='<div id="content" tabindex="0" style="width: 100%; height: 150px"></div>';function u(e,t,r){var n=t.find("#content")[0];function i(e,t){var r=new o.default(e,t.defaultTimeField,t.getSchema,a.default);r.initMonaco(t),r.addCommand(monaco.KeyMod.Shift|monaco.KeyCode.Enter,function(){var e=r.getValue();t.content=e,t.onChange()}),t.$watch("content",function(e,n){var o=r.getValue();e!==o&&e!==n&&t.$$postDigest(function(){r.setEditorContent(e)})}),r.setOnDidChangeModelContent(function(){t.$apply(function(){var e=r.getValue();t.content=e})}),t.$on("$destroy",function(){r.disposeMonaco()})}window.monaco?setTimeout(function(){i(n,e)},1):window.System.import("/"+e.pluginBaseUrl+"/lib/monaco.min.js").then(function(){setTimeout(function(){i(n,e)},1)}),n.onblur=function(){e.onChange()},n.onkeydown=function(e){if("Escape"===e.key)return e.stopPropagation(),!0}}function l(){return{restrict:"E",template:s,scope:{content:"=",onChange:"&",getSchema:"&",defaultTimeField:"@",pluginBaseUrl:"@"},link:u}}n.default.module("grafana.controllers").directive("kustoMonacoEditor",l)},function(e,t){e.exports=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),o=function(){function e(e,t,r,n){this.containerDiv=e,this.defaultTimeField=t,this.getSchema=r,this.config=n,this.splitWithNewLineRegex=/[^\n]+\n?|\n/g,this.newLineRegex=/\r?\n/,this.startsWithKustoPipeRegex=/^\|\s*/g,this.kustoPipeRegexStrict=/^\|\s*$/g}return e.prototype.initMonaco=function(e){var t=this,r=this.config.bootData.user.lightTheme?"grafana-light":"vs-dark";monaco.editor.defineTheme("grafana-light",{base:"vs",inherit:!0,rules:[{token:"comment",foreground:"008000"},{token:"variable.predefined",foreground:"800080"},{token:"function",foreground:"0000FF"},{token:"operator.sql",foreground:"FF4500"},{token:"string",foreground:"B22222"},{token:"operator.scss",foreground:"0000FF"},{token:"variable",foreground:"C71585"},{token:"variable.parameter",foreground:"9932CC"},{token:"",foreground:"000000"},{token:"type",foreground:"0000FF"},{token:"tag",foreground:"0000FF"},{token:"annotation",foreground:"2B91AF"},{token:"keyword",foreground:"0000FF"},{token:"number",foreground:"191970"},{token:"annotation",foreground:"9400D3"},{token:"invalid",background:"cd3131"}],colors:{"textCodeBlock.background":"#FFFFFF"}}),monaco.languages.kusto.kustoDefaults.setLanguageSettings({includeControlCommands:!0,newlineAfterPipe:!0,useIntellisenseV2:!1}),this.codeEditor=monaco.editor.create(this.containerDiv,{value:e.content||"Write your query here",language:"kusto",selectionHighlight:!1,theme:r,folding:!0,lineNumbers:"off",lineHeight:16,suggestFontSize:13,dragAndDrop:!1,occurrencesHighlight:!1,minimap:{enabled:!1},renderIndentGuides:!1,wordWrap:"on"}),this.codeEditor.layout(),1===monaco.editor.getModels().length&&(this.completionItemProvider=monaco.languages.registerCompletionItemProvider("kusto",{triggerCharacters:["."," "],provideCompletionItems:this.getCompletionItems.bind(this)}),this.signatureHelpProvider=monaco.languages.registerSignatureHelpProvider("kusto",{signatureHelpTriggerCharacters:["(",")"],provideSignatureHelp:this.getSignatureHelp.bind(this)})),this.codeEditor.createContextKey("readyToExecute",!0),this.codeEditor.onDidChangeCursorSelection(function(e){t.onDidChangeCursorSelection(e)}),this.getSchema().then(function(e){e&&monaco.languages.kusto.getKustoWorker().then(function(r){r(t.codeEditor.getModel().uri).then(function(r){var n=Object.keys(e.Databases).length>0?Object.keys(e.Databases)[0]:"";r.setSchemaFromShowSchema(e,"https://help.kusto.windows.net",n),t.codeEditor.layout()})})})},e.prototype.setOnDidChangeModelContent=function(e){this.codeEditor.onDidChangeModelContent(e)},e.prototype.disposeMonaco=function(){if(this.completionItemProvider)try{this.completionItemProvider.dispose()}catch(e){console.error("Failed to dispose the completion item provider.",e)}if(this.signatureHelpProvider)try{this.signatureHelpProvider.dispose()}catch(e){console.error("Failed to dispose the signature help provider.",e)}if(this.codeEditor)try{this.codeEditor.dispose()}catch(e){console.error("Failed to dispose the editor component.",e)}},e.prototype.addCommand=function(e,t){this.codeEditor.addCommand(e,t,"readyToExecute")},e.prototype.getValue=function(){return this.codeEditor.getValue()},e.prototype.toSuggestionController=function(e){return e},e.prototype.setEditorContent=function(e){this.codeEditor.setValue(e)},e.prototype.getCompletionItems=function(e,t){var r="##### Macro that uses the selected timerange in Grafana to filter the query.\n\n- `$__timeFilter()` -> Uses the "+this.defaultTimeField+" column\n\n- `$__timeFilter(datetimeColumn)` ->  Uses the specified datetime column to build the query.",o=e.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:t.lineNumber,endColumn:t.column});return n.default.includes(o,"|")?n.default.includes(o.toLowerCase(),"where")?n.default.includes(e.getLineContent(t.lineNumber).toLowerCase(),"where")?[{label:"$__timeFilter(timeColumn)",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__timeFilter(${0:"+this.defaultTimeField+"})"},documentation:{value:r}},{label:"$__from",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__from"},documentation:{value:"Built-in variable that returns the from value of the selected timerange in Grafana.\n\nExample: `where "+this.defaultTimeField+" > $__from` "}},{label:"$__to",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__to"},documentation:{value:"Built-in variable that returns the to value of the selected timerange in Grafana.\n\nExample: `where "+this.defaultTimeField+" < $__to` "}},{label:"$__interval",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"\\$__interval"},documentation:{value:"##### Built-in variable that returns an automatic time grain suitable for the current timerange.\n\nUsed with the bin() function - `bin("+this.defaultTimeField+", $__interval)` \n\n[Grafana docs](http://docs.grafana.org/reference/templating/#the-interval-variable)"}}]:[]:[{label:"where $__timeFilter(timeColumn)",kind:monaco.languages.CompletionItemKind.Keyword,insertText:{value:"where \\$__timeFilter(${0:"+this.defaultTimeField+"})"},documentation:{value:r}}]:[]},e.prototype.getSignatureHelp=function(e,t,r){return"$__timeFilter("!==e.getValueInRange({startLineNumber:t.lineNumber,startColumn:t.column-14,endLineNumber:t.lineNumber,endColumn:t.column})?{}:{activeParameter:0,activeSignature:0,signatures:[{label:"$__timeFilter(timeColumn)",parameters:[{label:"timeColumn",documentation:"Default is "+this.defaultTimeField+" column. Datetime column to filter data using the selected date range. "}]}]}},e.prototype.onDidChangeCursorSelection=function(e){"modelChange"===e.source&&e.reason===monaco.editor.CursorChangeReason.RecoverFromMarkers&&" "===this.getCharAt(e.selection.positionLineNumber,e.selection.positionColumn-1)&&this.triggerSuggestions()},e.prototype.triggerSuggestions=function(){var e=this.codeEditor.getContribution("editor.contrib.suggestController");if(e){var t=this.toSuggestionController(e);t._model.cancel(),setTimeout(function(){t._model.trigger(!0)},10)}},e.prototype.getCharAt=function(e,t){var r=this.codeEditor.getModel();if(0===r.getLineCount()||r.getLineCount()<e)return"";var n=r.getLineContent(e);return n.length<t||t<1?"":n[t-1]},e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.showHelp=!1,this.defaultQuery='<your table>\n| where $__timeFilter() \n| project TimeGenerated, Text=YourTitleColumn, Tags="tag1,tag2"',this.annotation.rawQuery=this.annotation.rawQuery||this.defaultQuery,this.databases=this.getDatabases()}return e.prototype.getDatabases=function(){var e=this;return this.databases&&this.databases.length>0?this.databases:this.datasource.getDatabases().then(function(t){return e.databases=t,t.length>0&&!e.annotation.database&&(e.annotation.database=t[0].value),e.databases}).catch(function(){})},e.templateUrl="partials/annotations.editor.html",e}();t.KustoDBAnnotationsQueryCtrl=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KustoDBConfigCtrl=void 0;var n=r(1),o=function(e){return e&&e.__esModule?e:{default:e}}(r(3)),a=r(16),i=function(){function e(e,t,r){var o=this;this.hasRequiredGrafanaVersion=this.hasMinVersion(),this.suggestUrl="https://yourcluster.kusto.windows.net",e.getSuggestUrls=function(){return[o.suggestUrl]},this.current.id&&(this.current.url="/api/datasources/proxy/"+this.current.id,this.kustoDbDatasource=new n.KustoDBDatasource(this.current,t,r,null),this.getDatabases())}return e.$inject=["$scope","backendSrv","$q"],e.prototype.getDatabases=function(){var e=this;return this.kustoDbDatasource.getDatabases().then(function(t){e.databases=t,e.databases.length>0&&(e.current.jsonData.defaultDatabase=e.current.jsonData.defaultDatabase||e.databases[0].value)})},e.prototype.hasMinVersion=function(){return(0,a.isVersionGtOrEq)(o.default.buildInfo.latestVersion,"5.3")||"5.3.0-beta1"===o.default.buildInfo.version||"5.3.0-pre1"===o.default.buildInfo.version},e.prototype.showMinVersionWarning=function(){return!this.hasRequiredGrafanaVersion},e.templateUrl="partials/config.html",e}();t.KustoDBConfigCtrl=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SemVersion=void 0,t.isVersionGtOrEq=function(e,t){return new a(e).isGtOrEq(t)};var n=function(e){return e&&e.__esModule?e:{default:e}}(r(0)),o=/^(\d+)(?:\.(\d+))?(?:\.(\d+))?(?:-([0-9A-Za-z\.]+))?/,a=function(){function e(e){var t=o.exec(e);t&&(this.major=Number(t[1]),this.minor=Number(t[2]||0),this.patch=Number(t[3]||0),this.meta=t[4])}return e.prototype.isGtOrEq=function(t){var r=new e(t);return!(this.major<r.major||this.minor<r.minor||this.patch<r.patch)},e.prototype.isValid=function(){return n.default.isNumber(this.major)},e}();t.SemVersion=a}])});
//# sourceMappingURL=module.js.map